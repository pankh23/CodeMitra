"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{7531:function(e,o,r){r.d(o,{Ho:function(){return u},aC:function(){return c},hi:function(){return m}});var t=r(7821),n=r(8078),s=r(8504),i=r(9190),a=r(9317),d=r(6028);let l=(0,n.createContext)(void 0);function u(e){let{children:o}=e,[r,u]=(0,n.useState)(null),[c,m]=(0,n.useState)(null),[g,p]=(0,n.useState)(!0),v=(0,s.useRouter)();(0,n.useEffect)(()=>{let e=a.Z.get("token"),o=a.Z.get("user");if(e&&o)try{m(e),u(JSON.parse(o))}catch(e){console.error("Failed to parse saved user:",e),a.Z.remove("token"),a.Z.remove("user")}p(!1)},[]);let f=async(e,o)=>{try{p(!0);let{token:r,user:t}=(await i.Z.post("/api/auth/login",{email:e,password:o})).data;a.Z.set("token",r,{expires:7}),a.Z.set("user",JSON.stringify(t),{expires:7}),m(r),u(t),d.ZP.success("Login successful!"),v.push("/dashboard")}catch(o){var r,t;let e=(null===(t=o.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.error)||"Login failed";throw d.ZP.error(e),o}finally{p(!1)}},h=async(e,o,r)=>{try{p(!0);let{token:t,user:n}=(await i.Z.post("/api/auth/register",{email:e,password:o,name:r})).data;a.Z.set("token",t,{expires:7}),a.Z.set("user",JSON.stringify(n),{expires:7}),m(t),u(n),d.ZP.success("Registration successful!"),v.push("/dashboard")}catch(o){var t,n;let e=(null===(n=o.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Registration failed";throw d.ZP.error(e),o}finally{p(!1)}};return(0,t.jsx)(l.Provider,{value:{user:r,token:c,isLoading:g,login:f,register:h,logout:()=>{a.Z.remove("token"),a.Z.remove("user"),m(null),u(null),d.ZP.success("Logged out successfully"),v.push("/")},updateUser:e=>{if(r){let o={...r,...e};u(o),a.Z.set("user",JSON.stringify(o),{expires:7})}}},children:o})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}i.Z.defaults.baseURL="http://localhost:5001",i.Z.defaults.timeout=1e4,i.Z.interceptors.request.use(e=>{let o=a.Z.get("token");return o&&(e.headers.Authorization="Bearer ".concat(o)),e},e=>Promise.reject(e)),i.Z.interceptors.response.use(e=>e,e=>{var o,r,t;if((null===(o=e.response)||void 0===o?void 0:o.status)===401){let o=(null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.error)||"";if(o.includes("Room requires a password")||o.includes("Invalid room password")||o.includes("Room not found")||o.includes("Room is full"))return console.log("\uD83D\uDD12 Business logic error, not logging out:",o),Promise.reject(e);console.log("\uD83D\uDEA8 Authentication error, logging out:",o),a.Z.remove("token"),a.Z.remove("user"),window.location.href="/"}return Promise.reject(e)});let m={get:async e=>(await i.Z.get(e)).data,post:async(e,o)=>(await i.Z.post(e,o)).data,put:async(e,o)=>(await i.Z.put(e,o)).data,delete:async e=>(await i.Z.delete(e)).data}},5597:function(e,o,r){r.d(o,{N:function(){return u},k:function(){return l}});var t=r(7821),n=r(8078),s=r(5331),i=r(7531),a=r(6028);let d=(0,n.createContext)(void 0);function l(e){let{children:o}=e,[r,l]=(0,n.useState)(null),[u,c]=(0,n.useState)([]),[m,g]=(0,n.useState)(!1),[p,v]=(0,n.useState)(null),[f,h]=(0,n.useState)(""),[Z,y]=(0,n.useState)("javascript"),[P,w]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[j,D]=(0,n.useState)(!1),{user:x}=(0,i.aC)(),{socket:I,joinRoom:R,leaveRoom:k,updateCode:E,executeCode:N,isConnected:b}=(0,s.s)();(0,n.useEffect)(()=>{if(!I)return;let e=e=>{l(e.room),h(e.room.code),y(e.room.language),w(e.room.input),S(e.room.output)},o=e=>{h(e.code),y(e.language),w(e.input),S(e.output)},r=e=>{e.userId!==(null==x?void 0:x.id)&&(h(e.code),e.language&&y(e.language))},t=e=>{e.userId!==(null==x?void 0:x.id)&&y(e.language)},n=e=>{e.userId!==(null==x?void 0:x.id)&&w(e.input)},s=e=>{D(!0),S("Executing...")},i=e=>{D(!1),S(e.output||e.error||"No output")};return I.on("room:joined",e),I.on("room:code-sync",o),I.on("code:updated",r),I.on("code:language-changed",t),I.on("code:input-updated",n),I.on("code:execution-started",s),I.on("code:execution-result",i),()=>{I.off("room:joined",e),I.off("room:code-sync",o),I.off("code:updated",r),I.off("code:language-changed",t),I.off("code:input-updated",n),I.off("code:execution-started",s),I.off("code:execution-result",i)}},[I,null==x?void 0:x.id]),(0,n.useEffect)(()=>{if(!I||!b)return;let e=e=>{console.log("\uD83D\uDC64 User joined room:",e),(null==r?void 0:r.id)===e.roomId&&(l(o=>{if(!o)return o;let r={id:e.user.id,userId:e.user.id,roomId:e.roomId,role:"member",joinedAt:e.timestamp,user:e.user,room:o};return{...o,users:[...o.users,r]}}),a.ZP.success("".concat(e.user.name," joined the room")))},o=e=>{console.log("\uD83D\uDC4B User left room:",e),(null==r?void 0:r.id)===e.roomId&&(l(o=>o?{...o,users:o.users.filter(o=>o.userId!==e.userId)}:o),(0,a.ZP)("".concat(e.userName," left the room")))},t=e=>{console.log("\uD83D\uDC65 Room users updated:",e),(null==r?void 0:r.id)===e.roomId&&l(o=>o?{...o,users:e.users.map(r=>({id:r.id,userId:r.id,roomId:e.roomId,role:r.role||"member",joinedAt:r.joinedAt||e.timestamp,user:{id:r.id,email:r.email,name:r.name,avatar:r.avatar,createdAt:e.timestamp,updatedAt:e.timestamp},room:o}))}:o)},n=e=>{console.log("\uD83D\uDCDD Code sync received:",e),(null==r?void 0:r.id)===e.roomId&&(h(e.code),y(e.language),w(e.input),S(e.output))};return I.on("room:user-joined",e),I.on("room:user-left",o),I.on("room:users",t),I.on("room:code-sync",n),()=>{I.off("room:user-joined",e),I.off("room:user-left",o),I.off("room:users",t),I.off("room:code-sync",n)}},[I,b,r]);let U=async e=>{try{g(!0),v(null);let o=(await i.hi.post("/api/rooms",e)).data;return c(e=>[o,...e]),l(o),h(o.code||""),y(o.language||"javascript"),w(o.input||""),S(o.output||""),b&&I&&(console.log("\uD83D\uDD0C Auto-joining socket room after creation:",o.id),R(o.id)),a.ZP.success('Room "'.concat(o.name,'" created successfully! Room Code: ').concat(o.id)),o}catch(t){var o,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.error)||"Failed to create room";throw v(e),a.ZP.error(e),t}finally{g(!1)}},A=async(e,o,r)=>{try{g(!0),v(null),console.log("\uD83D\uDE80 Joining room:",e,"with password:",o?"YES":"NO");let t=await i.hi.post("/api/rooms/join",{roomId:e,password:o});console.log("✅ Room join response:",t.data);let n=(await i.hi.get("/api/rooms/".concat(e))).data;l(n),R(e),console.log("\uD83C\uDF89 Successfully joined room and set as current"),r&&(console.log("\uD83E\uDDED Navigating to room editor:","/room/".concat(e,"/editor")),r.push("/room/".concat(e,"/editor")))}catch(o){var t,n;console.error("❌ Error joining room:",o);let e=(null===(n=o.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to join room";throw v(e),a.ZP.error(e),o}finally{g(!1)}},L=async e=>{try{g(!0),v(null),await i.hi.post("/api/rooms/".concat(e,"/leave"),{}),k(e),l(null),h(""),w(""),S("")}catch(t){var o,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.error)||"Failed to leave room";throw v(e),a.ZP.error(e),t}finally{g(!1)}},F=async(e,o)=>{try{g(!0),v(null);let t=(await i.hi.put("/api/rooms/".concat(e),o)).data;return c(o=>o.map(o=>o.id===e?t:o)),(null==r?void 0:r.id)===e&&l(t),a.ZP.success("Room updated successfully"),t}catch(o){var t,n;let e=(null===(n=o.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.error)||"Failed to update room";throw v(e),a.ZP.error(e),o}finally{g(!1)}},J=async e=>{try{g(!0),v(null),await i.hi.delete("/api/rooms/".concat(e)),c(o=>o.filter(o=>o.id!==e)),(null==r?void 0:r.id)===e&&l(null),a.ZP.success("Room deleted successfully")}catch(r){var o,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.error)||"Failed to delete room";throw v(e),a.ZP.error(e),r}finally{g(!1)}},V=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{g(!0),v(null);let o=new URLSearchParams;e.page&&o.append("page",e.page.toString()),e.limit&&o.append("limit",e.limit.toString()),e.search&&o.append("search",e.search),e.language&&o.append("language",e.language),void 0!==e.isPublic&&o.append("isPublic",e.isPublic.toString());let r=await i.hi.get("/api/rooms?".concat(o.toString()));c(r.data.rooms)}catch(t){var o,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.error)||"Failed to fetch rooms";throw v(e),a.ZP.error(e),t}finally{g(!1)}},O=async e=>{try{return g(!0),v(null),(await i.hi.get("/api/rooms/".concat(e))).data}catch(t){var o,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.error)||"Failed to fetch room";throw v(e),a.ZP.error(e),t}finally{g(!1)}};return(0,t.jsx)(d.Provider,{value:{currentRoom:r,rooms:u,isLoading:m,error:p,createRoom:U,joinRoom:A,leaveRoom:L,updateRoom:F,deleteRoom:J,getRooms:V,getRoom:O,setCurrentRoom:l,code:f,language:Z,input:P,output:C,isExecuting:j,setCode:e=>{h(e),r&&I&&E(r.id,e)},setLanguage:e=>{y(e),r&&I&&E(r.id,f,e)},setInput:e=>{w(e),r&&I&&I.emit("code:input-update",{roomId:r.id,input:e})},setOutput:S,executeCode:()=>{r&&I&&(D(!0),N(r.id,f,Z,P))}},children:o})}function u(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useRoom must be used within a RoomProvider");return e}},5331:function(e,o,r){r.d(o,{s:function(){return u},w:function(){return l}});var t=r(7821),n=r(8078),s=r(7093),i=r(7531),a=r(6028);let d=(0,n.createContext)(void 0);function l(e){let{children:o}=e,[r,l]=(0,n.useState)(null),[u,c]=(0,n.useState)(!1),{token:m,user:g}=(0,i.aC)();return(0,n.useEffect)(()=>{if(m&&g){let e=(0,s.io)("http://localhost:5001",{auth:{token:m},timeout:1e4,retries:3});return e.on("connect",()=>{console.log("Connected to socket server"),c(!0)}),e.on("disconnect",()=>{console.log("Disconnected from socket server"),c(!1)}),e.on("connect_error",e=>{console.error("Socket connection error:",e),a.ZP.error("Connection failed. Please try again.")}),e.on("room:joined",e=>{console.log("Joined room:",e),a.ZP.success("Joined room: ".concat(e.room.name))}),e.on("room:left",e=>{console.log("Left room:",e),a.ZP.success("Left room")}),e.on("room:user-joined",e=>{console.log("User joined room:",e),a.ZP.success("".concat(e.user.name," joined the room"))}),e.on("room:user-left",e=>{console.log("User left room:",e),(0,a.ZP)("".concat(e.userName," left the room"))}),e.on("room:error",e=>{console.error("Room error:",e),a.ZP.error(e.message||"Room error occurred")}),e.on("code:updated",e=>{console.log("Code updated:",e)}),e.on("code:language-changed",e=>{console.log("Language changed:",e)}),e.on("code:input-updated",e=>{console.log("Input updated:",e)}),e.on("code:execution-started",e=>{console.log("Code execution started:",e),(0,a.ZP)("Code execution started...")}),e.on("code:execution-result",e=>{console.log("Code execution result:",e)}),e.on("code:cursor-updated",e=>{console.log("Cursor updated:",e)}),e.on("code:selection-updated",e=>{console.log("Selection updated:",e)}),e.on("code:error",e=>{console.error("Code error:",e),a.ZP.error(e.message||"Code error occurred")}),e.on("chat:message-received",e=>{console.log("Message received:",e)}),e.on("chat:user-typing",e=>{console.log("User typing:",e)}),e.on("chat:user-stopped-typing",e=>{console.log("User stopped typing:",e)}),e.on("chat:error",e=>{console.error("Chat error:",e),a.ZP.error(e.message||"Chat error occurred")}),e.on("video:joined-call",e=>{console.log("Joined video call:",e),a.ZP.success("Joined video call")}),e.on("video:left-call",e=>{console.log("Left video call:",e),(0,a.ZP)("Left video call")}),e.on("video:user-joined",e=>{console.log("User joined video call:",e)}),e.on("video:user-left",e=>{console.log("User left video call:",e)}),e.on("video:offer-received",e=>{console.log("Video offer received:",e)}),e.on("video:answer-received",e=>{console.log("Video answer received:",e)}),e.on("video:ice-candidate-received",e=>{console.log("ICE candidate received:",e)}),e.on("video:user-mute-changed",e=>{console.log("User mute changed:",e)}),e.on("video:user-video-changed",e=>{console.log("User video changed:",e)}),e.on("video:screen-share-started",e=>{console.log("Screen share started:",e),(0,a.ZP)("".concat(e.userName," started screen sharing"))}),e.on("video:screen-share-stopped",e=>{console.log("Screen share stopped:",e),(0,a.ZP)("".concat(e.userName," stopped screen sharing"))}),e.on("video:error",e=>{console.error("Video error:",e),a.ZP.error(e.message||"Video error occurred")}),l(e),()=>{e.close()}}r&&(r.close(),l(null),c(!1))},[m,g]),(0,t.jsx)(d.Provider,{value:{socket:r,isConnected:u,joinRoom:e=>{r&&r.emit("room:join",{roomId:e})},leaveRoom:e=>{r&&r.emit("room:leave",{roomId:e})},sendMessage:(e,o)=>{r&&r.emit("chat:send-message",{roomId:e,content:o})},updateCode:(e,o,t)=>{r&&r.emit("code:update",{roomId:e,code:o,language:t})},executeCode:(e,o,t,n)=>{r&&r.emit("code:execute",{roomId:e,code:o,language:t,input:n})},updateInput:(e,o)=>{r&&r.emit("code:input-update",{roomId:e,input:o})},updateCursor:(e,o)=>{r&&r.emit("code:cursor-update",{roomId:e,position:o})},updateSelection:(e,o)=>{r&&r.emit("code:selection-update",{roomId:e,selection:o})},startTyping:e=>{r&&r.emit("chat:typing-start",{roomId:e})},stopTyping:e=>{r&&r.emit("chat:typing-stop",{roomId:e})},joinVideoCall:e=>{r&&r.emit("video:join-call",{roomId:e})},leaveVideoCall:e=>{r&&r.emit("video:leave-call",{roomId:e})},sendVideoOffer:(e,o,t)=>{r&&r.emit("video:offer",{roomId:e,targetUserId:o,offer:t})},sendVideoAnswer:(e,o,t)=>{r&&r.emit("video:answer",{roomId:e,targetUserId:o,answer:t})},sendIceCandidate:(e,o,t)=>{r&&r.emit("video:ice-candidate",{roomId:e,targetUserId:o,candidate:t})},toggleMute:(e,o)=>{r&&r.emit("video:toggle-mute",{roomId:e,isMuted:o})},toggleVideo:(e,o)=>{r&&r.emit("video:toggle-video",{roomId:e,isVideoOff:o})},startScreenShare:e=>{r&&r.emit("video:start-screen-share",{roomId:e})},stopScreenShare:e=>{r&&r.emit("video:stop-screen-share",{roomId:e})}},children:o})}function u(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}}}]);