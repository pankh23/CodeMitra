"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{7531:function(e,o,t){t.d(o,{Ho:function(){return c},aC:function(){return u},hi:function(){return v}});var r=t(7821),n=t(8078),a=t(8504),s=t(9190),i=t(9317),d=t(6028);let l=(0,n.createContext)(void 0);function c(e){let{children:o}=e,[t,c]=(0,n.useState)(null),[u,v]=(0,n.useState)(null),[p,g]=(0,n.useState)(!0),m=(0,a.useRouter)();(0,n.useEffect)(()=>{let e=i.Z.get("token"),o=i.Z.get("user");if(e&&o)try{v(e),c(JSON.parse(o))}catch(e){console.error("Failed to parse saved user:",e),i.Z.remove("token"),i.Z.remove("user")}g(!1)},[]);let f=async(e,o)=>{try{g(!0);let{token:t,user:r}=(await s.Z.post("/api/auth/login",{email:e,password:o})).data;i.Z.set("token",t,{expires:7}),i.Z.set("user",JSON.stringify(r),{expires:7}),v(t),c(r),d.ZP.success("Login successful!"),m.push("/dashboard")}catch(o){var t,r;let e=(null===(r=o.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Login failed";throw d.ZP.error(e),o}finally{g(!1)}},h=async(e,o,t)=>{try{g(!0);let{token:r,user:n}=(await s.Z.post("/api/auth/register",{email:e,password:o,name:t})).data;i.Z.set("token",r,{expires:7}),i.Z.set("user",JSON.stringify(n),{expires:7}),v(r),c(n),d.ZP.success("Registration successful!"),m.push("/dashboard")}catch(o){var r,n;let e=(null===(n=o.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.error)||"Registration failed";throw d.ZP.error(e),o}finally{g(!1)}};return(0,r.jsx)(l.Provider,{value:{user:t,token:u,isLoading:p,login:f,register:h,logout:()=>{i.Z.remove("token"),i.Z.remove("user"),v(null),c(null),d.ZP.success("Logged out successfully"),m.push("/")},updateUser:e=>{if(t){let o={...t,...e};c(o),i.Z.set("user",JSON.stringify(o),{expires:7})}}},children:o})}function u(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}s.Z.defaults.baseURL="http://localhost:8000",s.Z.defaults.timeout=1e4,s.Z.interceptors.request.use(e=>{let o=i.Z.get("token");return o&&(e.headers.Authorization="Bearer ".concat(o)),e},e=>Promise.reject(e)),s.Z.interceptors.response.use(e=>e,e=>{var o;return(null===(o=e.response)||void 0===o?void 0:o.status)===401&&(i.Z.remove("token"),i.Z.remove("user"),window.location.href="/"),Promise.reject(e)});let v={get:async e=>(await s.Z.get(e)).data,post:async(e,o)=>(await s.Z.post(e,o)).data,put:async(e,o)=>(await s.Z.put(e,o)).data,delete:async e=>(await s.Z.delete(e)).data}},5597:function(e,o,t){t.d(o,{N:function(){return c},k:function(){return l}});var r=t(7821),n=t(8078),a=t(7531),s=t(5331),i=t(6028);let d=(0,n.createContext)(void 0);function l(e){let{children:o}=e,[t,l]=(0,n.useState)(null),[c,u]=(0,n.useState)([]),[v,p]=(0,n.useState)(!1),[g,m]=(0,n.useState)(null),[f,h]=(0,n.useState)(""),[Z,y]=(0,n.useState)("javascript"),[P,w]=(0,n.useState)(""),[S,C]=(0,n.useState)(""),[x,j]=(0,n.useState)(!1),{user:k}=(0,a.aC)(),{socket:R,joinRoom:b,leaveRoom:L,updateCode:N,executeCode:U}=(0,s.s)();(0,n.useEffect)(()=>{if(!R)return;let e=e=>{l(e.room),h(e.room.code),y(e.room.language),w(e.room.input),C(e.room.output)},o=e=>{h(e.code),y(e.language),w(e.input),C(e.output)},t=e=>{e.userId!==(null==k?void 0:k.id)&&(h(e.code),e.language&&y(e.language))},r=e=>{e.userId!==(null==k?void 0:k.id)&&y(e.language)},n=e=>{e.userId!==(null==k?void 0:k.id)&&w(e.input)},a=e=>{j(!0),C("Executing...")},s=e=>{j(!1),C(e.output||e.error||"No output")};return R.on("room:joined",e),R.on("room:code-sync",o),R.on("code:updated",t),R.on("code:language-changed",r),R.on("code:input-updated",n),R.on("code:execution-started",a),R.on("code:execution-result",s),()=>{R.off("room:joined",e),R.off("room:code-sync",o),R.off("code:updated",t),R.off("code:language-changed",r),R.off("code:input-updated",n),R.off("code:execution-started",a),R.off("code:execution-result",s)}},[R,null==k?void 0:k.id]);let E=async e=>{try{p(!0),m(null);let o=(await a.hi.post("/api/rooms",e)).data;return u(e=>[o,...e]),i.ZP.success("Room created successfully"),o}catch(r){var o,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.error)||"Failed to create room";throw m(e),i.ZP.error(e),r}finally{p(!1)}},I=async(e,o)=>{try{p(!0),m(null),await a.hi.post("/api/rooms/join",{roomId:e,password:o}),b(e)}catch(o){var t,r;let e=(null===(r=o.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to join room";throw m(e),i.ZP.error(e),o}finally{p(!1)}},V=async e=>{try{p(!0),m(null),await a.hi.post("/api/rooms/".concat(e,"/leave"),{}),L(e),l(null),h(""),w(""),C("")}catch(r){var o,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.error)||"Failed to leave room";throw m(e),i.ZP.error(e),r}finally{p(!1)}},F=async(e,o)=>{try{p(!0),m(null);let r=(await a.hi.put("/api/rooms/".concat(e),o)).data;return u(o=>o.map(o=>o.id===e?r:o)),(null==t?void 0:t.id)===e&&l(r),i.ZP.success("Room updated successfully"),r}catch(o){var r,n;let e=(null===(n=o.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.error)||"Failed to update room";throw m(e),i.ZP.error(e),o}finally{p(!1)}},J=async e=>{try{p(!0),m(null),await a.hi.delete("/api/rooms/".concat(e)),u(o=>o.filter(o=>o.id!==e)),(null==t?void 0:t.id)===e&&l(null),i.ZP.success("Room deleted successfully")}catch(t){var o,r;let e=(null===(r=t.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.error)||"Failed to delete room";throw m(e),i.ZP.error(e),t}finally{p(!1)}},O=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{p(!0),m(null);let o=new URLSearchParams;e.page&&o.append("page",e.page.toString()),e.limit&&o.append("limit",e.limit.toString()),e.search&&o.append("search",e.search),e.language&&o.append("language",e.language),void 0!==e.isPublic&&o.append("isPublic",e.isPublic.toString());let t=await a.hi.get("/api/rooms?".concat(o.toString()));u(t.data.rooms)}catch(r){var o,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.error)||"Failed to fetch rooms";throw m(e),i.ZP.error(e),r}finally{p(!1)}},_=async e=>{try{return p(!0),m(null),(await a.hi.get("/api/rooms/".concat(e))).data}catch(r){var o,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.error)||"Failed to fetch room";throw m(e),i.ZP.error(e),r}finally{p(!1)}};return(0,r.jsx)(d.Provider,{value:{currentRoom:t,rooms:c,isLoading:v,error:g,createRoom:E,joinRoom:I,leaveRoom:V,updateRoom:F,deleteRoom:J,getRooms:O,getRoom:_,setCurrentRoom:l,code:f,language:Z,input:P,output:S,isExecuting:x,setCode:e=>{h(e),t&&R&&N(t.id,e)},setLanguage:e=>{y(e),t&&R&&N(t.id,f,e)},setInput:e=>{w(e),t&&R&&R.emit("code:input-update",{roomId:t.id,input:e})},setOutput:C,executeCode:()=>{t&&R&&(j(!0),U(t.id,f,Z,P))}},children:o})}function c(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useRoom must be used within a RoomProvider");return e}},5331:function(e,o,t){t.d(o,{s:function(){return c},w:function(){return l}});var r=t(7821),n=t(8078),a=t(7093),s=t(7531),i=t(6028);let d=(0,n.createContext)(void 0);function l(e){let{children:o}=e,[t,l]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1),{token:v,user:p}=(0,s.aC)();return(0,n.useEffect)(()=>{if(v&&p){let e=(0,a.io)("http://localhost:8000",{auth:{token:v},timeout:1e4,retries:3});return e.on("connect",()=>{console.log("Connected to socket server"),u(!0)}),e.on("disconnect",()=>{console.log("Disconnected from socket server"),u(!1)}),e.on("connect_error",e=>{console.error("Socket connection error:",e),i.ZP.error("Connection failed. Please try again.")}),e.on("room:joined",e=>{console.log("Joined room:",e),i.ZP.success("Joined room: ".concat(e.room.name))}),e.on("room:left",e=>{console.log("Left room:",e),i.ZP.success("Left room")}),e.on("room:user-joined",e=>{console.log("User joined room:",e),i.ZP.success("".concat(e.user.name," joined the room"))}),e.on("room:user-left",e=>{console.log("User left room:",e),(0,i.ZP)("".concat(e.userName," left the room"))}),e.on("room:error",e=>{console.error("Room error:",e),i.ZP.error(e.message||"Room error occurred")}),e.on("code:updated",e=>{console.log("Code updated:",e)}),e.on("code:language-changed",e=>{console.log("Language changed:",e)}),e.on("code:input-updated",e=>{console.log("Input updated:",e)}),e.on("code:execution-started",e=>{console.log("Code execution started:",e),(0,i.ZP)("Code execution started...")}),e.on("code:execution-result",e=>{console.log("Code execution result:",e)}),e.on("code:cursor-updated",e=>{console.log("Cursor updated:",e)}),e.on("code:selection-updated",e=>{console.log("Selection updated:",e)}),e.on("code:error",e=>{console.error("Code error:",e),i.ZP.error(e.message||"Code error occurred")}),e.on("chat:message-received",e=>{console.log("Message received:",e)}),e.on("chat:user-typing",e=>{console.log("User typing:",e)}),e.on("chat:user-stopped-typing",e=>{console.log("User stopped typing:",e)}),e.on("chat:error",e=>{console.error("Chat error:",e),i.ZP.error(e.message||"Chat error occurred")}),e.on("video:joined-call",e=>{console.log("Joined video call:",e),i.ZP.success("Joined video call")}),e.on("video:left-call",e=>{console.log("Left video call:",e),(0,i.ZP)("Left video call")}),e.on("video:user-joined",e=>{console.log("User joined video call:",e)}),e.on("video:user-left",e=>{console.log("User left video call:",e)}),e.on("video:offer-received",e=>{console.log("Video offer received:",e)}),e.on("video:answer-received",e=>{console.log("Video answer received:",e)}),e.on("video:ice-candidate-received",e=>{console.log("ICE candidate received:",e)}),e.on("video:user-mute-changed",e=>{console.log("User mute changed:",e)}),e.on("video:user-video-changed",e=>{console.log("User video changed:",e)}),e.on("video:screen-share-started",e=>{console.log("Screen share started:",e),(0,i.ZP)("".concat(e.userName," started screen sharing"))}),e.on("video:screen-share-stopped",e=>{console.log("Screen share stopped:",e),(0,i.ZP)("".concat(e.userName," stopped screen sharing"))}),e.on("video:error",e=>{console.error("Video error:",e),i.ZP.error(e.message||"Video error occurred")}),l(e),()=>{e.close()}}t&&(t.close(),l(null),u(!1))},[v,p]),(0,r.jsx)(d.Provider,{value:{socket:t,isConnected:c,joinRoom:e=>{t&&t.emit("room:join",{roomId:e})},leaveRoom:e=>{t&&t.emit("room:leave",{roomId:e})},sendMessage:(e,o)=>{t&&t.emit("chat:send-message",{roomId:e,content:o})},updateCode:(e,o,r)=>{t&&t.emit("code:update",{roomId:e,code:o,language:r})},executeCode:(e,o,r,n)=>{t&&t.emit("code:execute",{roomId:e,code:o,language:r,input:n})},updateInput:(e,o)=>{t&&t.emit("code:input-update",{roomId:e,input:o})},updateCursor:(e,o)=>{t&&t.emit("code:cursor-update",{roomId:e,position:o})},updateSelection:(e,o)=>{t&&t.emit("code:selection-update",{roomId:e,selection:o})},startTyping:e=>{t&&t.emit("chat:typing-start",{roomId:e})},stopTyping:e=>{t&&t.emit("chat:typing-stop",{roomId:e})},joinVideoCall:e=>{t&&t.emit("video:join-call",{roomId:e})},leaveVideoCall:e=>{t&&t.emit("video:leave-call",{roomId:e})},sendVideoOffer:(e,o,r)=>{t&&t.emit("video:offer",{roomId:e,targetUserId:o,offer:r})},sendVideoAnswer:(e,o,r)=>{t&&t.emit("video:answer",{roomId:e,targetUserId:o,answer:r})},sendIceCandidate:(e,o,r)=>{t&&t.emit("video:ice-candidate",{roomId:e,targetUserId:o,candidate:r})},toggleMute:(e,o)=>{t&&t.emit("video:toggle-mute",{roomId:e,isMuted:o})},toggleVideo:(e,o)=>{t&&t.emit("video:toggle-video",{roomId:e,isVideoOff:o})},startScreenShare:e=>{t&&t.emit("video:start-screen-share",{roomId:e})},stopScreenShare:e=>{t&&t.emit("video:stop-screen-share",{roomId:e})}},children:o})}function c(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}}}]);